# é¡¹ç›®æ€»ç»“

## ä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜è§£ç­”

### 1. eBPF ç¼–è¯‘é—®é¢˜

**Q: è¿™å¾—æ‰¾ä¸ª Linux æœºå™¨è¿è¡Œç¼–è¯‘ï¼Ÿ**

**A: ä¸éœ€è¦ï¼æœ‰å¤šç§æ–¹æ¡ˆï¼š**

| æ–¹æ¡ˆ | é€‚ç”¨åœºæ™¯ | è¯´æ˜ |
|------|---------|------|
| **Windows å¼€å‘** | æ—¥å¸¸å¼€å‘ | Go ä»£ç ç›´æ¥ç¼–è¯‘ï¼ŒeBPF è‡ªåŠ¨ç¦ç”¨ï¼ˆæœ‰ stubï¼‰ |
| **Docker** | æœ¬åœ°æµ‹è¯• | `docker build` è‡ªåŠ¨ç¼–è¯‘ eBPF |
| **WSL2** | Windows å¼€å‘ | åœ¨ WSL2 ä¸­ç¼–è¯‘å®Œæ•´ç‰ˆæœ¬ |
| **CI/CD** | ç”Ÿäº§æ„å»º | GitHub Actions/GitLab CI è‡ªåŠ¨ç¼–è¯‘ |

**å…³é”®**ï¼š
- âœ… Go ä»£ç å¯ä»¥åœ¨ Windows ç¼–è¯‘ï¼ˆeBPF è‡ªåŠ¨ç¦ç”¨ï¼‰
- âœ… eBPF ç¨‹åºéœ€è¦ Linux ç¯å¢ƒï¼ˆDocker/WSL2/CIï¼‰
- âœ… æœ‰ä¼˜é›…é™çº§ï¼šWindows ä¸Šç½‘å…³æ­£å¸¸å·¥ä½œï¼Œåªæ˜¯æ²¡æœ‰ eBPF åŠ é€Ÿ

è¯¦è§ï¼š[ç¼–è¯‘æŒ‡å—](COMPILE.md)

### 2. äº‘åŸç”Ÿç‰¹æ€§

**Q: Go ä»£ç çš„äº‘åŸç”Ÿä½“ç°åœ¨ä»€ä¹ˆåœ°æ–¹ï¼Ÿ**

**A: ä½“ç°åœ¨ 10 ä¸ªæ–¹é¢ï¼š**

#### âœ… 1. é…ç½®å¤–éƒ¨åŒ– (12-Factor)
- ç¯å¢ƒå˜é‡è¦†ç›–é»˜è®¤å€¼
- ConfigMap çƒ­åŠ è½½æ”¯æŒ

#### âœ… 2. Kubernetes æœåŠ¡å‘ç°
- è‡ªåŠ¨è§£æ K8s DNS (`service.namespace.svc.cluster.local`)
- æ— éœ€ç¡¬ç¼–ç  IP åœ°å€

#### âœ… 3. å¥åº·æ£€æŸ¥
- `/health` - Liveness Probe
- `/ready` - Readiness Probeï¼ˆæ”¯æŒ Drain Modeï¼‰

#### âœ… 4. ä¼˜é›…å…³é—­
- SIGTERM ä¿¡å·å¤„ç†
- Drain Modeï¼ˆé•¿è¿æ¥æ’ç©ºï¼‰
- é…åˆ `terminationGracePeriodSeconds`

#### âœ… 5. Prometheus Metrics
- æ ‡å‡† `/metrics` ç«¯ç‚¹
- Golden Metricsï¼šQPSã€Latencyã€Errors

#### âœ… 6. åˆ†å¸ƒå¼è¿½è¸ª
- OpenTelemetry é›†æˆ
- Jaeger å¯¼å‡º
- è·¨æœåŠ¡è¿½è¸ª

#### âœ… 7. ç»“æ„åŒ–æ—¥å¿—
- JSON æ ¼å¼è¾“å‡º
- æ ‡å‡†è¾“å‡ºï¼ˆK8s è‡ªåŠ¨æ”¶é›†ï¼‰

#### âœ… 8. è‡ªåŠ¨æ‰©ç¼©å®¹ (HPA)
- CPU æŒ‡æ ‡
- è‡ªå®šä¹‰ QPS æŒ‡æ ‡

#### âœ… 9. æœåŠ¡ç½‘æ ¼å°±ç»ª
- Istio/Linkerd å…¼å®¹
- Trace context ä¼ æ’­

#### âœ… 10. å¤šç¯å¢ƒæ”¯æŒ
- è‡ªåŠ¨æ£€æµ‹ K8s ç¯å¢ƒ
- K8s/æœ¬åœ°æ¨¡å¼è‡ªåŠ¨åˆ‡æ¢

è¯¦è§ï¼š[äº‘åŸç”Ÿç‰¹æ€§è¯¦è§£](CLOUD-NATIVE.md)

## é¡¹ç›®æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Unified Access Gateway                     â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Cloud Native Layer                              â”‚  â”‚
â”‚  â”‚  - K8s Service Discovery                         â”‚  â”‚
â”‚  â”‚  - ConfigMap Hot Reload                          â”‚  â”‚
â”‚  â”‚  - Health Checks                                  â”‚  â”‚
â”‚  â”‚  - Graceful Shutdown                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                        â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Observability Layer                               â”‚ â”‚
â”‚  â”‚  - Prometheus Metrics                              â”‚ â”‚
â”‚  â”‚  - OpenTelemetry Tracing                           â”‚ â”‚
â”‚  â”‚  - Structured Logging                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                        â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  eBPF Acceleration Layer                           â”‚ â”‚
â”‚  â”‚  - XDP (DDoS Protection)                           â”‚ â”‚
â”‚  â”‚  - SockMap (Zero-Copy)                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                        â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Protocol Layer                                   â”‚ â”‚
â”‚  â”‚  - HTTP/HTTPS                                      â”‚ â”‚
â”‚  â”‚  - TCP                                             â”‚ â”‚
â”‚  â”‚  - WebSocket                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯ | ç”¨é€” |
|------|------|------|
| **è¯­è¨€** | Go 1.21+ | é«˜æ€§èƒ½ã€å¹¶å‘å‹å¥½ |
| **ç½‘ç»œ** | eBPF (XDP + SockMap) | å†…æ ¸çº§åŠ é€Ÿ |
| **æœåŠ¡å‘ç°** | K8s DNS | è‡ªåŠ¨è§£æ Service |
| **é…ç½®** | Env Vars + ConfigMap | 12-Factor |
| **ç›‘æ§** | Prometheus | Metrics |
| **è¿½è¸ª** | OpenTelemetry + Jaeger | åˆ†å¸ƒå¼è¿½è¸ª |
| **éƒ¨ç½²** | Kubernetes | å®¹å™¨ç¼–æ’ |
| **æ‰©ç¼©å®¹** | HPA | è‡ªåŠ¨å¼¹æ€§ |

## æ ¸å¿ƒæ–‡ä»¶

### äº‘åŸç”Ÿç‰¹æ€§

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `internal/discovery/k8s.go` | K8s æœåŠ¡å‘ç° |
| `internal/config/k8s.go` | ConfigMap çƒ­åŠ è½½ |
| `internal/observability/tracing.go` | åˆ†å¸ƒå¼è¿½è¸ª |
| `internal/middleware/cloudnative.go` | äº‘åŸç”Ÿä¸­é—´ä»¶ |
| `internal/core/server.go` | å¥åº·æ£€æŸ¥ã€ä¼˜é›…å…³é—­ |

### eBPF åŠ é€Ÿ

| æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|
| `pkg/ebpf/xdp_filter.c` | XDP DDoS é˜²æŠ¤ |
| `pkg/ebpf/xdp.go` | XDP ç®¡ç†å™¨ |
| `pkg/ebpf/sockmap.c` | SockMap é›¶æ‹·è´ |
| `pkg/ebpf/sockmap.go` | SockMap ç®¡ç†å™¨ |

## éƒ¨ç½²ç¤ºä¾‹

### Kubernetes Deployment

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: unified-access-gateway
spec:
  replicas: 3
  template:
    spec:
      containers:
      - name: gateway
        image: skynet/unified-access-gateway:latest
        env:
        - name: HTTP_BACKEND_SERVICE
          value: "httpproxy-service"  # K8s Service åç§°
        - name: TCP_BACKEND_SERVICE
          value: "gateserver-service"
        - name: JAEGER_ENDPOINT
          value: "http://jaeger:14268/api/traces"
        ports:
        - containerPort: 8080
        - containerPort: 9090
        livenessProbe:
          httpGet:
            path: /health
            port: 9090
        readinessProbe:
          httpGet:
            path: /ready
            port: 9090
        resources:
          requests:
            cpu: 100m
            memory: 128Mi
          limits:
            cpu: 2000m
            memory: 2Gi
```

### HPA (è‡ªåŠ¨æ‰©ç¼©å®¹)

```yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: unified-access-gateway
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: unified-access-gateway
  minReplicas: 3
  maxReplicas: 20
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        averageUtilization: 70
  - type: Pods
    pods:
      metric:
        name: gateway_requests_per_second
      target:
        averageValue: "1000"
```

## æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| **HTTP åå** | 50k+ req/s | å•å®ä¾‹ï¼Œ4 æ ¸ |
| **TCP å¹¶å‘** | 100k+ | é•¿è¿æ¥ |
| **å»¶è¿Ÿ (P99)** | <1ms | æœ¬åœ°ç½‘ç»œ |
| **XDP å¤„ç†** | 20-30 Mpps | DDoS é˜²æŠ¤ |
| **SockMap åŠ é€Ÿ** | -50% å»¶è¿Ÿ | é›¶æ‹·è´ |

## æ–‡æ¡£ç´¢å¼•

| æ–‡æ¡£ | å†…å®¹ |
|------|------|
| [ç¼–è¯‘æŒ‡å—](COMPILE.md) | è·¨å¹³å°ç¼–è¯‘ç­–ç•¥ |
| [äº‘åŸç”Ÿç‰¹æ€§](CLOUD-NATIVE.md) | 10 å¤§äº‘åŸç”Ÿç‰¹æ€§è¯¦è§£ |
| [eBPF æŠ€æœ¯](EBPF.md) | SockMap åŸç†ä¸å®ç° |
| [XDP é˜²æŠ¤](XDP.md) | DDoS é˜²æŠ¤è¯¦è§£ |
| [æ„å»ºæŒ‡å—](BUILD.md) | å®Œæ•´æ„å»ºæµç¨‹ |
| [ä¾èµ–ç®¡ç†](DEPENDENCIES.md) | é›¶ä¾èµ–æ–¹æ¡ˆ |

## æ€»ç»“

**è¿™æ˜¯ä¸€ä¸ªçœŸæ­£çš„äº‘åŸç”Ÿç½‘å…³**ï¼š

1. âœ… **ä¸æ˜¯"èƒ½åœ¨ K8s ä¸Šè¿è¡Œ"**ï¼Œè€Œæ˜¯**"ä¸º K8s è€Œç”Ÿ"**
2. âœ… **ä¸æ˜¯"ç®€å•çš„åå‘ä»£ç†"**ï¼Œè€Œæ˜¯**"ç”Ÿäº§çº§ç»Ÿä¸€ç½‘å…³"**
3. âœ… **ä¸æ˜¯"æ¦‚å¿µéªŒè¯"**ï¼Œè€Œæ˜¯**"å¯ç›´æ¥éƒ¨ç½²"**

**æ ¸å¿ƒä»·å€¼**ï¼š
- ğŸš€ **æ€§èƒ½**ï¼šeBPF å†…æ ¸çº§åŠ é€Ÿ
- ğŸ›¡ï¸ **å®‰å…¨**ï¼šXDP DDoS é˜²æŠ¤
- ğŸ“Š **å¯è§‚æµ‹**ï¼šMetrics + Tracing + Logging
- ğŸ”„ **å¼¹æ€§**ï¼šHPA è‡ªåŠ¨æ‰©ç¼©å®¹
- ğŸ¯ **äº‘åŸç”Ÿ**ï¼šK8s åŸç”Ÿé›†æˆ

**é€‚åˆåœºæ™¯**ï¼š
- å¾®æœåŠ¡ç½‘å…³
- æ¸¸æˆç½‘å…³ï¼ˆé•¿è¿æ¥ï¼‰
- API ç½‘å…³
- è¾¹ç¼˜ç½‘å…³

**é¢è¯•å±•ç¤º**ï¼š
1. è®²è§£äº‘åŸç”Ÿ 10 å¤§ç‰¹æ€§
2. æ¼”ç¤º eBPF åŒé‡åŠ é€Ÿï¼ˆXDP + SockMapï¼‰
3. å±•ç¤º K8s é›†æˆï¼ˆæœåŠ¡å‘ç°ã€å¥åº·æ£€æŸ¥ã€HPAï¼‰
4. å¼ºè°ƒç”Ÿäº§çº§è®¾è®¡ï¼ˆä¼˜é›…é™çº§ã€å¯è§‚æµ‹æ€§ï¼‰

---

**è¿™æ‰æ˜¯é¡¶çº§æ°´å¹³çš„äº‘åŸç”Ÿç½‘å…³ï¼** ğŸ‰

